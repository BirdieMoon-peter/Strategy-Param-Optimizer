# Optimizer é€šç”¨å°è£…å®Œæˆè¯´æ˜Ž

## ðŸ“¦ å°è£…æ¦‚è¿°

å·²æˆåŠŸå°†Optimizerå°è£…ä¸ºé€šç”¨çš„ç­–ç•¥ä¼˜åŒ–å·¥å…·ï¼Œå¯ä¾›ä»»æ„æ ‡çš„å’Œç­–ç•¥ä½¿ç”¨ã€‚

---

## âœ… å®Œæˆçš„åŠŸèƒ½

### 1. è¾“å…¥æ”¯æŒ âœ“

- âœ… **CSVæ•°æ®æ–‡ä»¶**ï¼šæ”¯æŒä»»æ„æ ‡çš„ï¼Œåªéœ€æä¾›åŒ…å«OHLCVåˆ—çš„CSVæ–‡ä»¶
- âœ… **ç­–ç•¥è„šæœ¬**ï¼šåŠ¨æ€åŠ è½½Pythonç­–ç•¥æ–‡ä»¶ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç 
- âœ… **ä¼˜åŒ–ç›®æ ‡**ï¼šæ”¯æŒå¤šç§ç›®æ ‡ï¼ˆå¤æ™®æ¯”çŽ‡ã€å¹´åŒ–æ”¶ç›Šã€å¡çŽ›æ¯”çŽ‡ç­‰ï¼‰
- âœ… **LLMå¼€å…³**ï¼šå¯é€‰æ‹©æ˜¯å¦ä½¿ç”¨LLMè¾…åŠ©ä¼˜åŒ–

### 2. LLMé›†æˆ âœ“

- âœ… **å¤šç§APIæ”¯æŒ**ï¼š
  - OpenAI (GPT-4, GPT-3.5)
  - Ollama (æœ¬åœ°æ¨¡åž‹)
  - è‡ªå®šä¹‰API
- âœ… **å†…ç½®System Prompt**ï¼š
  - ç­–ç•¥å‚æ•°åˆ†æžæç¤ºè¯
  - ä¼˜åŒ–åŽ†å²åˆ†æžæç¤ºè¯
  - ç»“æžœè§£é‡Šæç¤ºè¯
- âœ… **çµæ´»é…ç½®**ï¼šç”¨æˆ·å¯è‡ªè¡Œè®¾å®šAPIå¯†é’¥ã€base URLç­‰

### 3. è¾“å‡ºæ ¼å¼ âœ“

- âœ… **JSONæ ¼å¼**ï¼šç»“æž„åŒ–ã€æ˜“è¯»ã€æ˜“è§£æž
- âœ… **æœ€ä¼˜å‚æ•°**ï¼šæ¸…æ™°å±•ç¤ºæœ€ä½³å‚æ•°ç»„åˆ
- âœ… **æ€§èƒ½æŒ‡æ ‡**ï¼šå…¨é¢çš„å›žæµ‹æ€§èƒ½æ•°æ®
- âœ… **é€å¹´è¡¨çŽ°**ï¼šæ¯å¹´çš„æ”¶ç›Šã€å›žæ’¤ã€å¤æ™®æ¯”çŽ‡
- âœ… **LLMè§£é‡Š**ï¼š
  - å‚æ•°æœ‰æ•ˆæ€§è§£é‡Š
  - æ€§èƒ½åˆ†æž
  - é£Žé™©è¯„ä¼°
  - å®žæˆ˜å»ºè®®
  - å…³é”®æ´žå¯Ÿ

### 4. ä½¿ç”¨æŒ‡å— âœ“

- âœ… **UNIVERSAL_OPTIMIZER_GUIDE.md**ï¼šå®Œæ•´ä½¿ç”¨æ‰‹å†Œï¼ˆè‹±æ–‡ä¸ºä¸»ï¼‰
- âœ… **å¿«é€Ÿå¼€å§‹.md**ï¼š5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹æŒ‡å—ï¼ˆä¸­æ–‡ï¼‰
- âœ… **README_UNIVERSAL.md**ï¼šé¡¹ç›®è¯´æ˜Žæ–‡æ¡£
- âœ… **example_strategy.py**ï¼šç¤ºä¾‹ç­–ç•¥å’Œç¼–å†™æŒ‡å—
- âœ… **ä½¿ç”¨ç¤ºä¾‹.py**ï¼š6ä¸ªå®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹
- âœ… **config_example.py**ï¼šé…ç½®ç¤ºä¾‹æ–‡ä»¶

---

## ðŸ“ æ–°å¢žæ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶

1. **universal_llm_client.py** (422è¡Œ)
   - é€šç”¨LLMå®¢æˆ·ç«¯ç±»
   - æ”¯æŒOpenAIã€Ollamaã€è‡ªå®šä¹‰API
   - å†…ç½®ä¸“ä¸šsystem prompt
   - é¢„è®¾é…ç½®æ¨¡æ¿

2. **universal_optimizer.py** (483è¡Œ)
   - é€šç”¨ä¼˜åŒ–å™¨ä¸»ç±»
   - åŠ¨æ€åŠ è½½æ•°æ®å’Œç­–ç•¥
   - é›†æˆè´å¶æ–¯ä¼˜åŒ–å’ŒLLM
   - ç”ŸæˆJSONæ ¼å¼ç»“æžœ

### å·¥å…·æ–‡ä»¶

3. **run_universal_optimizer.py** (260è¡Œ)
   - å‘½ä»¤è¡Œå…¥å£è„šæœ¬
   - æ”¯æŒæ‰€æœ‰å‚æ•°é…ç½®
   - å®Œæ•´çš„å‚æ•°è¯´æ˜Ž
   - æ‰¹é‡ä¼˜åŒ–æ”¯æŒ

4. **test_universal_optimizer.py** (302è¡Œ)
   - æµ‹è¯•å¥—ä»¶
   - 4ä¸ªç‹¬ç«‹æµ‹è¯•ç”¨ä¾‹
   - è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æ•°æ®
   - éªŒè¯æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½

### ç¤ºä¾‹æ–‡ä»¶

5. **example_strategy.py** (215è¡Œ)
   - 4ä¸ªå®Œæ•´çš„ç­–ç•¥ç¤ºä¾‹
   - è¯¦ç»†çš„ç­–ç•¥ç¼–å†™æŒ‡å—
   - æ³¨é‡Šä¸°å¯Œ
   - å¯ç›´æŽ¥ä½¿ç”¨

6. **ä½¿ç”¨ç¤ºä¾‹.py** (365è¡Œ)
   - 6ä¸ªå®Œæ•´ä½¿ç”¨åœºæ™¯
   - äº¤äº’å¼ç¤ºä¾‹é€‰æ‹©
   - åŒ…å«ä»£ç æ³¨é‡Š
   - æ¶µç›–æ‰€æœ‰åŠŸèƒ½

7. **config_example.py** (136è¡Œ)
   - å„ç§LLMé…ç½®ç¤ºä¾‹
   - ä¼˜åŒ–å™¨é…ç½®æ¨¡æ¿
   - å¼€ç®±å³ç”¨

### æ–‡æ¡£æ–‡ä»¶

8. **UNIVERSAL_OPTIMIZER_GUIDE.md** (600+è¡Œ)
   - å®Œæ•´ä½¿ç”¨æ‰‹å†Œ
   - è¯¦ç»†APIæ–‡æ¡£
   - å¸¸è§é—®é¢˜è§£ç­”
   - æŠ€æœ¯ç»†èŠ‚è¯´æ˜Ž

9. **å¿«é€Ÿå¼€å§‹.md** (350+è¡Œ)
   - 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
   - ä¸­æ–‡è¯´æ˜Ž
   - æ­¥éª¤æ¸…æ™°
   - ç¤ºä¾‹ä¸°å¯Œ

10. **README_UNIVERSAL.md** (450+è¡Œ)
    - é¡¹ç›®æ€»è§ˆ
    - ç‰¹æ€§ä»‹ç»
    - å¿«é€Ÿå¯¼èˆª
    - ç¾Žè§‚æŽ’ç‰ˆ

11. **å°è£…å®Œæˆè¯´æ˜Ž.md** (æœ¬æ–‡ä»¶)
    - å°è£…æ€»ç»“
    - æ–‡ä»¶æ¸…å•
    - ä½¿ç”¨æ–¹æ³•
    - æ³¨æ„äº‹é¡¹

---

## ðŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1ï¼šPythonè„šæœ¬

```python
from universal_optimizer import UniversalOptimizer
from universal_llm_client import UniversalLLMConfig

# ä¸ä½¿ç”¨LLM
optimizer = UniversalOptimizer(
    data_path="data/BTC.csv",
    strategy_path="strategies/my_strategy.py",
    objective="sharpe_ratio",
    use_llm=False
)

result = optimizer.optimize(n_trials=50)

# ä½¿ç”¨LLM
llm_config = UniversalLLMConfig(
    api_type="openai",
    base_url="https://api.openai.com/v1",
    model_name="gpt-4",
    api_key="sk-xxx"
)

optimizer = UniversalOptimizer(
    data_path="data/BTC.csv",
    strategy_path="strategies/my_strategy.py",
    objective="sharpe_ratio",
    use_llm=True,
    llm_config=llm_config
)

result = optimizer.optimize(n_trials=50)
```

### æ–¹æ³•2ï¼šå‘½ä»¤è¡Œ

```bash
# åŸºæœ¬ç”¨æ³•
python run_universal_optimizer.py \
    --data data/BTC.csv \
    --strategy strategies/my_strategy.py \
    --objective sharpe_ratio \
    --trials 50

# ä½¿ç”¨LLM
python run_universal_optimizer.py \
    --data data/BTC.csv \
    --strategy strategies/my_strategy.py \
    --use-llm \
    --llm-type openai \
    --llm-model gpt-4 \
    --api-key sk-xxx \
    --trials 50

# æ‰¹é‡ä¼˜åŒ–
python run_universal_optimizer.py \
    --data data/BTC.csv \
    --strategy strategies/my_strategy.py \
    --batch \
    --objectives sharpe_ratio annual_return calmar_ratio \
    --trials 50
```

### æ–¹æ³•3ï¼šäº¤äº’å¼ç¤ºä¾‹

```bash
python ä½¿ç”¨ç¤ºä¾‹.py
# ç„¶åŽæŒ‰æç¤ºé€‰æ‹©è¦è¿è¡Œçš„ç¤ºä¾‹
```

---

## ðŸ“Š JSONè¾“å‡ºæ ¼å¼ç¤ºä¾‹

```json
{
  "optimization_info": {
    "asset_name": "BTC",
    "strategy_name": "MyStrategy",
    "optimization_objective": "sharpe_ratio",
    "optimization_time": "2024-01-15 10:30:00",
    "data_range": {
      "start": "2023-01-01",
      "end": "2024-01-01",
      "total_days": 365
    }
  },
  "best_parameters": {
    "fast_period": 12,
    "slow_period": 26
  },
  "performance_metrics": {
    "sharpe_ratio": 1.85,
    "annual_return": 35.2,
    "max_drawdown": -12.5,
    "total_return": 35.2,
    "final_value": 135200.0,
    "trades_count": 45,
    "win_rate": 62.5
  },
  "yearly_performance": {
    "2023": {
      "return": 35.2,
      "drawdown": -12.5,
      "sharpe_ratio": 1.85
    }
  },
  "llm_explanation": {
    "parameter_explanation": "è¯¥å‚æ•°ç»„åˆåœ¨è¶‹åŠ¿å¸‚åœºä¸­è¡¨çŽ°ä¼˜å¼‚...",
    "performance_analysis": "ç­–ç•¥åœ¨2023å¹´å®žçŽ°äº†35.2%çš„å¹´åŒ–æ”¶ç›Š...",
    "risk_assessment": "æœ€å¤§å›žæ’¤æŽ§åˆ¶åœ¨12.5%ä»¥å†…ï¼Œé£Žé™©å¯æŽ§...",
    "practical_suggestions": "å»ºè®®åœ¨å®žç›˜å‰è¿›è¡Œæ ·æœ¬å¤–æµ‹è¯•...",
    "key_insights": [
      "å¿«çº¿å‘¨æœŸ12ä¸Žæ…¢çº¿å‘¨æœŸ26çš„é…æ¯”æœ€ä¼˜",
      "åœ¨è¶‹åŠ¿æ˜Žç¡®çš„å¸‚åœºçŽ¯å¢ƒä¸­è¡¨çŽ°æœ€ä½³",
      "å»ºè®®é…åˆé£Žé™©ç®¡ç†æŽªæ–½ä½¿ç”¨"
    ]
  }
}
```

---

## ðŸ§ª æµ‹è¯•

è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ï¼š

```bash
cd /Users/peter/Desktop/é‡åŒ–/project_trend
conda activate quant
python Optimizer/test_universal_optimizer.py
```

æµ‹è¯•åŒ…æ‹¬ï¼š
- âœ… åŸºæœ¬ä¼˜åŒ–åŠŸèƒ½
- âœ… LLMè¾…åŠ©ä¼˜åŒ–
- âœ… æ‰¹é‡ä¼˜åŒ–
- âœ… JSONè¾“å‡ºæ ¼å¼éªŒè¯

---

## âš™ï¸ ä¾èµ–è¦æ±‚

å·²æœ‰ä¾èµ–ï¼ˆæ— éœ€é¢å¤–å®‰è£…ï¼‰ï¼š
- backtrader
- pandas
- numpy
- optuna
- requests

ç¡®ä¿åœ¨`quant` condaçŽ¯å¢ƒä¸­è¿è¡Œã€‚

---

## ðŸ“– ç­–ç•¥ç¼–å†™è¦æ±‚

ç­–ç•¥æ–‡ä»¶å¿…é¡»ï¼š

1. ç»§æ‰¿ `backtrader.Strategy`
2. åœ¨ `params` å…ƒç»„ä¸­å®šä¹‰æ‰€æœ‰å‚æ•°
3. å®žçŽ° `__init__` å’Œ `next` æ–¹æ³•

ç¤ºä¾‹ï¼š

```python
import backtrader as bt

class MyStrategy(bt.Strategy):
    params = (
        ('period', 20),
        ('threshold', 0.02),
    )
    
    def __init__(self):
        self.ma = bt.indicators.SMA(self.data.close, period=self.params.period)
    
    def next(self):
        if not self.position:
            if self.data.close > self.ma * (1 + self.params.threshold):
                self.buy()
        else:
            if self.data.close < self.ma * (1 - self.params.threshold):
                self.sell()
```

è¯¦è§ `example_strategy.py` ä¸­çš„å®Œæ•´ç¤ºä¾‹å’ŒæŒ‡å—ã€‚

---

## ðŸ“ æ•°æ®æ–‡ä»¶è¦æ±‚

CSVæ–‡ä»¶å¿…é¡»åŒ…å«ä»¥ä¸‹åˆ—ï¼ˆåˆ—åå°å†™ï¼‰ï¼š

- `datetime` - æ—¶é—´æˆ³
- `open` - å¼€ç›˜ä»·
- `high` - æœ€é«˜ä»·
- `low` - æœ€ä½Žä»·
- `close` - æ”¶ç›˜ä»·
- `volume` - æˆäº¤é‡

ç¤ºä¾‹ï¼š

```csv
datetime,open,high,low,close,volume
2024-01-01 00:00:00,42000,42500,41800,42300,1000000
2024-01-01 01:00:00,42300,42800,42200,42700,950000
```

---

## ðŸŽ¯ æ”¯æŒçš„ä¼˜åŒ–ç›®æ ‡

- `sharpe_ratio` - å¤æ™®æ¯”çŽ‡ï¼ˆæŽ¨èï¼‰
- `annual_return` - å¹´åŒ–æ”¶ç›ŠçŽ‡
- `calmar_ratio` - å¡çŽ›æ¯”çŽ‡
- `sortino_ratio` - ç´¢æè¯ºæ¯”çŽ‡
- `max_drawdown` - æœ€å¤§å›žæ’¤
- `total_return` - æ€»æ”¶ç›ŠçŽ‡

---

## ðŸ’¡ ä½¿ç”¨å»ºè®®

### æ–°æ‰‹æŽ¨èæµç¨‹

1. **æµ‹è¯•çŽ¯å¢ƒ**
   ```bash
   python Optimizer/test_universal_optimizer.py
   ```

2. **è¿è¡Œç¤ºä¾‹**
   ```bash
   python Optimizer/ä½¿ç”¨ç¤ºä¾‹.py
   # é€‰æ‹©ç¤ºä¾‹1ï¼ˆåŸºæœ¬ä¼˜åŒ–ï¼‰
   ```

3. **ä½¿ç”¨è‡ªå·±çš„æ•°æ®**
   - å‡†å¤‡CSVæ•°æ®æ–‡ä»¶
   - ä½¿ç”¨ç¤ºä¾‹ç­–ç•¥æˆ–ç¼–å†™è‡ªå·±çš„ç­–ç•¥
   - ä¸å¯ç”¨LLMå…ˆæµ‹è¯•

4. **å¯ç”¨LLM**
   - é…ç½®APIå¯†é’¥
   - æŸ¥çœ‹LLMçš„åˆ†æžå’Œå»ºè®®

5. **æ‰¹é‡ä¼˜åŒ–**
   - æ¯”è¾ƒä¸åŒä¼˜åŒ–ç›®æ ‡
   - é€‰æ‹©æœ€é€‚åˆçš„å‚æ•°

### è¿›é˜¶ç”¨æ³•

- æ ·æœ¬å¤–éªŒè¯ï¼šä¿ç•™éƒ¨åˆ†æ•°æ®ç”¨äºŽéªŒè¯
- Walk-Forwardåˆ†æžï¼šæ»šåŠ¨ä¼˜åŒ–å’Œæµ‹è¯•
- å¤šç­–ç•¥ç»„åˆï¼šä¼˜åŒ–å¤šä¸ªç­–ç•¥å¹¶ç»„åˆ
- å®žç›˜å‰æµ‹è¯•ï¼šæ¨¡æ‹Ÿäº¤æ˜“éªŒè¯

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **LLMä½¿ç”¨**
   - éœ€è¦APIå¯†é’¥ï¼ˆOpenAIï¼‰æˆ–å¯åŠ¨OllamaæœåŠ¡
   - LLMè°ƒç”¨ä¼šå¢žåŠ ä¼˜åŒ–æ—¶é—´
   - å¯ä»¥é€‰æ‹©ä¸ä½¿ç”¨LLM

2. **æ€§èƒ½ä¼˜åŒ–**
   - å‚æ•°è¶Šå¤šï¼Œéœ€è¦çš„è¯•éªŒæ¬¡æ•°è¶Šå¤š
   - å»ºè®®ä»Žè¾ƒå°‘è¯•éªŒæ¬¡æ•°å¼€å§‹
   - ä½¿ç”¨æ‰¹é‡ä¼˜åŒ–æ—¶æ³¨æ„æ€»æ—¶é—´

3. **è¿‡æ‹Ÿåˆé£Žé™©**
   - ä¸è¦è¿‡åº¦ä¼˜åŒ–
   - ä¿ç•™æ ·æœ¬å¤–æ•°æ®éªŒè¯
   - å…³æ³¨ç­–ç•¥é€»è¾‘çš„åˆç†æ€§

4. **æ•°æ®è´¨é‡**
   - ç¡®ä¿æ•°æ®å®Œæ•´æ— ç¼ºå¤±
   - æ—¶é—´æˆ³æ ¼å¼æ­£ç¡®
   - ä»·æ ¼å’Œæˆäº¤é‡åˆç†

---

## ðŸ“š æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | ç”¨é€” | é€‚åˆäººç¾¤ |
|------|------|----------|
| **å¿«é€Ÿå¼€å§‹.md** | 5åˆ†é’Ÿä¸Šæ‰‹ | æ‰€æœ‰äºº |
| **README_UNIVERSAL.md** | é¡¹ç›®æ¦‚è§ˆ | åˆæ¬¡ä½¿ç”¨ |
| **UNIVERSAL_OPTIMIZER_GUIDE.md** | å®Œæ•´æ‰‹å†Œ | æ·±å…¥ä½¿ç”¨ |
| **example_strategy.py** | ç­–ç•¥ç¤ºä¾‹ | ç­–ç•¥å¼€å‘è€… |
| **ä½¿ç”¨ç¤ºä¾‹.py** | ä»£ç ç¤ºä¾‹ | Pythonç”¨æˆ· |
| **config_example.py** | é…ç½®ç¤ºä¾‹ | é«˜çº§ç”¨æˆ· |

---

## ðŸŽ‰ æ€»ç»“

âœ… å°è£…å®Œæˆï¼ŒåŠŸèƒ½é½å…¨  
âœ… æ–‡æ¡£è¯¦ç»†ï¼Œæ˜“äºŽä¸Šæ‰‹  
âœ… ç¤ºä¾‹ä¸°å¯Œï¼Œæ¶µç›–å„ç§åœºæ™¯  
âœ… æµ‹è¯•å®Œå¤‡ï¼Œç¨³å®šå¯é   

**å¼€å§‹ä½¿ç”¨é€šç”¨ç­–ç•¥ä¼˜åŒ–å™¨ï¼Œæå‡ä½ çš„é‡åŒ–äº¤æ˜“ç­–ç•¥ï¼** ðŸš€

---

## ðŸ“® é—®é¢˜åé¦ˆ

å¦‚é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ç›¸å…³æ–‡æ¡£
2. è¿è¡Œæµ‹è¯•è„šæœ¬è¯Šæ–­
3. æ£€æŸ¥æ—¥å¿—è¾“å‡ºï¼ˆverbose=Trueï¼‰
4. å‚è€ƒä½¿ç”¨ç¤ºä¾‹

---

**å°è£…å®Œæˆæ—¶é—´**: 2024å¹´1æœˆ  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
